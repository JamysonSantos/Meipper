<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meipper - Do zero ao fluxo em poucos cliques.</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/drawflow@0.0.60/dist/drawflow.min.css">
    <link rel="icon" href="faviconmeipper01.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Auth Loading Overlay -->
    <div id="auth-loading-overlay" class="auth-loading-overlay">
        <div class="auth-loading-content">
            <div class="auth-loading-spinner"></div>
            <h3>Verificando autentica√ß√£o...</h3>
            <p>Aguarde um momento</p>
        </div>
    </div>

    <!- Login Modal ->
    <div id="login-modal" class="auth-modal">
  <div class="auth-modal-content">
    <div class="auth-modal-header">
      <img src="logomeipper01.png" alt="Logo Meipper" class="auth-logo" />
      <h2>Entrar no Meipper</h2>
      <p>Acesse sua conta para continuar</p>
    </div>
    
    <form id="login-form" class="auth-form">
      <div class="auth-form-group">
        <label for="login-email">E-mail:</label>
        <input type="email" id="login-email" required placeholder="seu@email.com">
      </div>
      
      <div class="auth-form-group">
        <label for="login-password">Senha:</label>
        <div class="password-input-container">
          <input type="password" id="login-password" required placeholder="Digite sua senha">
          <button type="button" class="password-toggle" data-target="login-password">
            <span class="eye-icon">üëÅÔ∏è</span>
          </button>
        </div>
      </div>
      
      <div class="auth-buttons">
        <button type="submit" class="auth-btn primary" id="login-btn">
          <span class="btn-text">Entrar</span>
          <div class="btn-spinner" style="display: none;"></div>
        </button>
        <button type="button" class="auth-btn secondary" id="show-register-btn">
          Criar conta
        </button>
      </div>
      
      <div class="auth-footer">
        <button type="button" class="forgot-password-link" id="show-forgot-password">
          Esqueci minha senha
        </button>
      </div>
    </form>
    
    <div id="login-error" class="auth-error" style="display: none;"></div>
  </div>
</div>

    <!-- Register Modal -->
<div id="register-modal" class="auth-modal">
  <div class="auth-modal-content">
    <div class="auth-modal-header">
      <img src="logomeipper02.png" alt="Logo Meipper" class="auth-logo" />
      <h2>Criar Conta</h2>
      <p>Cadastre-se para come√ßar a usar o Meipper</p>
    </div>
    
    <form id="register-form" class="auth-form">
      
      <!-- Nome -->
      <div class="auth-form-group">
        <label for="register-name">Nome:</label>
        <input type="text" id="register-name" required placeholder="Digite seu nome">
      </div>

      <!-- Foto -->
      <div class="auth-form-group">
        <label for="register-photo">Foto (opcional):</label>
        <input type="file" id="register-photo" accept="image/*">
        <div id="photo-feedback" class="photo-feedback" style="display:none;">Foto selecionada ‚úÖ</div>
        <div class="photo-preview" id="photo-preview" style="display:none;">
          <img id="preview-img" alt="Pr√©-visualiza√ß√£o da foto">
        </div>
      </div>

      <!-- E-mail -->
      <div class="auth-form-group">
        <label for="register-email">E-mail:</label>
        <input type="email" id="register-email" required placeholder="seu@email.com">
      </div>
      
      <!-- Senha -->
      <div class="auth-form-group">
        <label for="register-password">Criar senha:</label>
        <div class="password-input-container">
          <input type="password" id="register-password" required placeholder="Digite uma senha forte" minlength="6">
          <button type="button" class="password-toggle" data-target="register-password">
            <span class="eye-icon">üëÅÔ∏è</span>
          </button>
        </div>
        <small class="password-hint">M√≠nimo 6 caracteres</small>
      </div>
      
      <!-- Confirmar senha -->
      <div class="auth-form-group">
        <label for="confirm-password">Confirmar senha:</label>
        <div class="password-input-container">
          <input type="password" id="register-confirm-password" required placeholder="Digite novamente a senha">
          <button type="button" class="password-toggle" data-target="confirm-password">
            <span class="eye-icon">üëÅÔ∏è</span>
          </button>
        </div>
      </div>
      
      <!-- Bot√µes -->
      <div class="auth-buttons">
        <button type="submit" class="auth-btn primary" id="register-btn">
          <span class="btn-text">Cadastrar</span>
          <div class="btn-spinner" style="display: none;"></div>
        </button>
      </div>
      
      <div class="auth-footer">
        <button type="button" class="back-to-login" id="back-to-login">
          ‚Üê Voltar ao login
        </button>
      </div>
    </form>
    
    <div id="register-error" class="auth-error" style="display: none;"></div>
  </div>
</div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <img src="logomeipper02.png" alt="Logo Meipper" class="auth-logo" />
                <h2>Recuperar Senha</h2>
                <p>Digite seu e-mail para receber instru√ß√µes de recupera√ß√£o</p>
            </div>
            
            <form id="forgot-password-form" class="auth-form">
                <div class="auth-form-group">
                    <label for="forgot-email">E-mail:</label>
                    <input type="email" id="forgot-email" required placeholder="seu@email.com">
                </div>
                
                <div class="auth-buttons">
                    <button type="submit" class="auth-btn primary" id="forgot-password-btn">
                        <span class="btn-text">Enviar instru√ß√µes</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                </div>
                
                <div class="auth-footer">
                    <button type="button" class="back-to-login" id="back-to-login-from-forgot">
                        ‚Üê Voltar ao login
                    </button>
                </div>
            </form>
            
            <div id="forgot-password-error" class="auth-error" style="display: none;"></div>
            <div id="forgot-password-success" class="auth-success" style="display: none;"></div>
        </div>
    </div>

    <!-- Success Message Modal -->
    <div id="success-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <div class="success-icon">‚úÖ</div>
                <h2>Cadastro realizado com sucesso!</h2>
                <p>Use seu e-mail e senha cadastrados para entrar</p>
            </div>
            
            <div class="auth-buttons">
                <button type="button" class="auth-btn primary" id="success-ok-btn">
                    Fazer Login
                </button>
            </div>
        </div>
    </div>

    <!-- Main App Content (hidden until authenticated) -->
    <div id="main-app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <img src="logomeipper02.png" alt="Logo Meipper" class="logo" />
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="header-btn secondary" data-action="show-saved-flows">
                            <span class="btn-icon"></span>
                            <span class="btn-text">Fluxos Salvos</span>
                        </button>
                        <button class="header-btn secondary" data-action="load-flow">
                            <span class="btn-icon"></span>
                            <span class="btn-text">Carregar</span>
                        </button>
                        <button class="header-btn secondary" data-action="clear-all">
                            <span class="btn-icon"></span>
                            <span class="btn-text">Limpar tudo</span>
                        </button>
                        <button class="header-btn primary" data-action="save-flow">
                            <span class="btn-icon"></span>
                            <span class="btn-text">Salvar</span>
                        </button>
                        <div class="export-dropdown">
                            <button class="header-btn export" data-action="toggle-export">
                                <span class="btn-icon"></span>
                                <span class="btn-text">Exportar</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="export-menu" id="export-menu">
                                <div class="export-section">
                                    <button class="export-option" data-action="export-png">
                                        <span class="btn-text">Fluxo (PNG)</span>
                                    </button>
                                    <button class="export-option" data-action="export-pdf">
                                        <span class="btn-text">Fluxo (PDF)</span>
                                    </button>
                                </div>
                                <div class="export-section">
                                    <button class="export-option" data-action="export-doc-pdf">
                                        <span class="btn-text">Documenta√ß√£o (PDF)</span>
                                    </button>
                                    <button class="export-option" data-action="export-doc-word">
                                        <span class="btn-text">Documenta√ß√£o (Word)</span>
                                    </button>
                                    <button class="export-option" data-action="export-editable">
                                    <span class="btn-text">Fluxo Edit√°vel (.meipperflow)</span>
                                    </button>
                                  </div>
                                </div>
                            </div>
                        <div class="user-menu-container">
                          <div id="menu-icon">‚â°</div>
                          <div id="user-menu" class="hidden">
                          <div id="user-name-display"></div>
                          <button id="logout-btn">Sair</button>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Process Info Card -->
        <div class="process-info-card">
            <div class="process-info-content">
                <div class="process-info-left">
                    <div class="process-name-section">
                        <div>
                            <h3>Nome do Processo:</h3>
                            <div class="process-name" id="process-display-name">Processo sem nome</div>
                        </div>
                    </div>
                    <div class="actors-section">
                        <div>
                            <h3>Respons√°veis:</h3>
                            <div class="actors-legend" id="actors-legend"></div>
                        </div>
                    </div>
                </div>
                <div class="zoom-info">
                    <div id="zoom-display"></div>
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Sidebar -->
        <div class="sidebar">
            <!-- Process Name -->
            <div class="form-group">
                <label for="process-name">Nome do Processo:</label>
                <input type="text" id="process-name" placeholder="Ex: Aprova√ß√£o de Faturas">
            </div>

            <!-- Undo/Redo Controls -->
            <div class="history-controls">
                <button class="modern-btn warning" id="undo-btn" data-action="undo" disabled>
                    <span class="btn-icon">‚Ü∂</span>
                    <span class="btn-text">Desfazer</span>
                </button>
                <button class="modern-btn warning" id="redo-btn" data-action="redo" disabled>
                    <span class="btn-icon">‚Ü∑</span>
                    <span class="btn-text">Refazer</span>
                </button>
            </div>

                <!-- Actor Management -->
                <div class="form-group">
                    <label for="actor-input">Respons√°vel/Setor/Cargo:</label>
                    <textarea id="actor-input" placeholder="Ex: Financeiro"></textarea>
                    
                    <label>Cor:</label>
                    <div class="color-picker" id="color-picker"></div>
                    <button class="modern-btn secondary small" data-action="more-colors">
                        <span class="btn-icon">üé®</span>
                        <span class="btn-text">Mais cores</span>
                    </button>
                    
                    <button class="modern-btn primary" data-action="add-actor">
                        <span class="btn-icon">üë§</span>
                        <span class="btn-text">Salvar Respons√°vel</span>
                    </button>

                    <div class="actors-list" id="actors-list"></div>

                    <label for="actor-select">Selecionar Respons√°vel:</label>
                    <select id="actor-select">
                        <option value="">Selecione...</option>
                    </select>
                </div>

                <!-- Task Management -->
                <div class="form-group">
                    <label>Gerenciar Tarefas:</label>
                    
                    <button class="modern-btn success large" data-action="add-start-task">
                        <span class="btn-icon">‚ñ∂</span>
                        <span class="btn-text">Iniciar Fluxo</span>
                    </button>

                    <textarea id="task-input" placeholder="Digite a tarefa..."></textarea>
                    
                    <!-- Task Description Field -->
                    <label for="task-description-input">Descri√ß√£o da Tarefa (opcional):</label>
                    <textarea id="task-description-input" placeholder="Descreva como executar esta tarefa..." style="min-height: 100px;"></textarea>

                    <button class="modern-btn primary" data-action="add-task">
                        <span class="btn-icon">‚ûï</span>
                        <span class="btn-text">Adicionar Tarefa</span>
                    </button>

                    <button class="modern-btn purple" data-action="start-gateway">
                        <span class="btn-icon">‚óÜ</span>
                        <span class="btn-text">Inserir caminhos para tarefa</span>
                    </button>

                    <button class="modern-btn danger" data-action="add-end-task">
                        <span class="btn-icon">‚èπ</span>
                        <span class="btn-text">Finalizar Fluxo</span>
                    </button>
                </div>

                <!-- Gateway Panel -->
                <div id="gateway-panel" class="gateway-panel" style="display: none;">
                    <h3>Caminhos de Decis√£o</h3>
                    
                    <div class="form-group">
                        <label for="gateway-question">Pergunta de decis√£o:</label>
                        <textarea id="gateway-question" placeholder="Ex: A solicita√ß√£o foi aprovada?"></textarea>
                    </div>

                    <div class="gateway-paths" id="gateway-paths"></div>

                    <div class="gateway-buttons">
                        <button class="modern-btn primary" data-action="add-gateway-path">
                            <span class="btn-icon">‚ûï</span>
                            <span class="btn-text">Adicionar caminho</span>
                        </button>
                        <button class="modern-btn success" data-action="finalize-gateway">
                            <span class="btn-icon">‚úÖ</span>
                            <span class="btn-text">Confirmar</span>
                        </button>
                        <button class="modern-btn secondary" data-action="cancel-gateway">
                            <span class="btn-icon">‚ùå</span>
                            <span class="btn-text">Cancelar</span>
                        </button>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="instructions">
                    <h4>üí° Como usar:</h4>
                    <ul>
                        <li>Clique em uma tarefa para selecion√°-la</li>
                        <li>Duplo clique para editar texto das tarefas e labels</li>
                        <li>Clique no bot√£o "+" para ver/editar descri√ß√µes</li>
                        <li>Novas tarefas ser√£o adicionadas ap√≥s a selecionada</li>
                        <li>Clique no bot√£o direito ou em DELETE para excluir tarefas</li>
                        <li>Arraste tarefas para reposicion√°-las</li>
                        <li>Use scroll do mouse para zoom</li>
                        <li>Use Ctrl+Z/Ctrl+Y para desfazer/refazer</li>
                    </ul>
                </div>
            </div>

            <!-- Canvas Area -->
            <div class="canvas-container">
            <!-- Canvas Controls -->
            <div class="canvas-controls">
                 <button data-action="zoom-in">üîç +</button>
                 <button data-action="zoom-out">üîç -</button>
                 <button data-action="reset-zoom">‚åÇ Reset</button>
            </div>

                <!-- Drawflow Container -->
            <div id="drawflow"></div>
        </div>
    </div>

        <!-- Description Popup -->
        <div id="description-popup" class="description-popup">
            <div class="description-popup-content">
                <div class="description-popup-header">
                    <h3 class="description-popup-title" id="description-popup-title">Descri√ß√£o da Tarefa</h3>
                    <button class="description-popup-close" id="description-popup-close">√ó</button>
                </div>
                <div class="description-popup-body">
                    <label for="description-popup-textarea">Descri√ß√£o detalhada:</label>
                    <textarea id="description-popup-textarea" placeholder="Descreva detalhadamente como executar esta tarefa..."></textarea>
                </div>
                <div class="description-popup-footer">
                    <button class="modern-btn secondary" id="description-popup-cancel">Cancelar</button>
                    <button class="modern-btn primary" id="description-popup-save">Salvar</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h3 id="loading-text">Processando...</h3>
                <p id="loading-subtitle">Aguarde um momento</p>
            </div>
          </div>

        <!-- Saved Flows Popup -->
        <div id="saved-flows-popup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="popup-header">
                <h3>Biblioteca de Fluxos</h3>
                <button class="popup-close" id="close-saved-flows-popup">√ó</button>
            </div>
            <div class="popup-body">
                <div class="search-container">
                    <input type="text" id="flow-search" placeholder="Buscar fluxo..." class="search-input">
                </div>
                <div id="saved-flows-container" class="flows-container">
                    <!-- Os fluxos ser√£o carregados aqui -->
                    <div class="no-flows-message" style="display: none;">Nenhum fluxo salvo ainda</div>
                    <div class="instructions" style="margin-top: 20px;">
                        <p>Selecione um fluxo para carreg√°-lo (substituir√° o fluxo atual)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Firebase Configuration -->
    <script type="module" src="firebase-config.js"></script>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/drawflow@0.0.60/dist/drawflow.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx/build/index.js"></script>
    
    <!-- Application Scripts -->
    <script src="auth.js"></script>
    <script src="script.js"></script>
</body>
</html>
