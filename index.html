<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meipper - Modelagem de Processos</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Overlay de Autentica√ß√£o -->
    <div id="auth-loading-overlay" class="auth-loading-overlay">
        <div class="auth-loading-content">
            <div class="auth-loading-spinner"></div>
            <h3>Carregando...</h3>
            <p>Verificando autentica√ß√£o</p>
        </div>
    </div>

    <!-- Modal de Login -->
    <div id="login-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <img src="https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="Logo" class="auth-logo">
                <h2>Bem-vindo de volta!</h2>
                <p>Entre com sua conta para continuar</p>
            </div>
            
            <form id="login-form" class="auth-form">
                <div class="auth-form-group">
                    <label for="login-email">E-mail</label>
                    <input type="email" id="login-email" required>
                </div>
                
                <div class="auth-form-group">
                    <label for="login-password">Senha</label>
                    <div class="password-input-container">
                        <input type="password" id="login-password" required>
                        <button type="button" class="password-toggle" data-target="login-password">
                            <span class="eye-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
                
                <div class="auth-error" id="login-error" style="display: none;"></div>
                
                <div class="auth-buttons">
                    <button type="submit" id="login-btn" class="auth-btn primary">
                        <span class="btn-text">Entrar</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    
                    <button type="button" id="show-register-btn" class="auth-btn secondary">
                        Criar nova conta
                    </button>
                </div>
                
                <div class="auth-footer">
                    <button type="button" id="show-forgot-password" class="forgot-password-link">
                        Esqueceu sua senha?
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Cadastro -->
    <div id="register-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <img src="https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="Logo" class="auth-logo">
                <h2>Criar conta</h2>
                <p>Preencha os dados para come√ßar</p>
            </div>
            
            <form id="register-form" class="auth-form">
                <div class="auth-form-group">
                    <label for="register-name">Nome completo *</label>
                    <input type="text" id="register-name" required placeholder="Digite seu nome completo">
                </div>

                <div class="auth-form-group">
                    <label for="register-photo">Foto de perfil (opcional)</label>
                    <input type="url" id="register-photo" placeholder="URL da sua foto de perfil">
                    <div class="photo-preview" id="photo-preview" style="display: none;">
                        <img id="photo-preview-img" src="" alt="Preview da foto" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-top: 8px;">
                    </div>
                </div>
                
                <div class="auth-form-group">
                    <label for="register-email">E-mail *</label>
                    <input type="email" id="register-email" required>
                </div>
                
                <div class="auth-form-group">
                    <label for="register-password">Senha *</label>
                    <div class="password-input-container">
                        <input type="password" id="register-password" required>
                        <button type="button" class="password-toggle" data-target="register-password">
                            <span class="eye-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                    <div class="password-hint">M√≠nimo de 6 caracteres</div>
                </div>
                
                <div class="auth-form-group">
                    <label for="confirm-password">Confirmar senha *</label>
                    <div class="password-input-container">
                        <input type="password" id="confirm-password" required>
                        <button type="button" class="password-toggle" data-target="confirm-password">
                            <span class="eye-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
                
                <div class="auth-error" id="register-error" style="display: none;"></div>
                
                <div class="auth-buttons">
                    <button type="submit" id="register-btn" class="auth-btn primary">
                        <span class="btn-text">Criar conta</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    
                    <button type="button" id="back-to-login" class="auth-btn secondary">
                        J√° tenho conta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Recupera√ß√£o de Senha -->
    <div id="forgot-password-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <img src="https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="Logo" class="auth-logo">
                <h2>Recuperar senha</h2>
                <p>Digite seu e-mail para receber as instru√ß√µes</p>
            </div>
            
            <form id="forgot-password-form" class="auth-form">
                <div class="auth-form-group">
                    <label for="forgot-email">E-mail</label>
                    <input type="email" id="forgot-email" required>
                </div>
                
                <div class="auth-error" id="forgot-password-error" style="display: none;"></div>
                <div class="auth-success" id="forgot-password-success" style="display: none;"></div>
                
                <div class="auth-buttons">
                    <button type="submit" id="forgot-password-btn" class="auth-btn primary">
                        <span class="btn-text">Enviar instru√ß√µes</span>
                        <div class="btn-spinner" style="display: none;"></div>
                    </button>
                    
                    <button type="button" id="back-to-login-from-forgot" class="auth-btn secondary">
                        Voltar ao login
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div id="success-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <div class="success-icon">‚úÖ</div>
                <h2>Conta criada com sucesso!</h2>
                <p>Agora voc√™ pode fazer login com suas credenciais</p>
            </div>
            
            <div class="auth-buttons">
                <button type="button" id="success-ok-btn" class="auth-btn primary">
                    Fazer login
                </button>
            </div>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="main-app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <img src="https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=200&h=80&fit=crop" alt="Meipper" class="logo">
                </div>
                
                <div class="header-right">
                    <div class="header-actions">
                        <button id="save-btn" class="header-btn primary">
                            <span class="btn-icon">üíæ</span>
                            <span class="btn-text">Salvar</span>
                        </button>
                        
                        <button id="load-btn" class="header-btn secondary">
                            <span class="btn-icon">üìÇ</span>
                            <span class="btn-text">Carregar</span>
                        </button>
                        
                        <div class="export-dropdown" id="export-dropdown">
                            <button id="export-btn" class="header-btn export">
                                <span class="btn-icon">üì§</span>
                                <span class="btn-text">Exportar</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="export-menu" id="export-menu">
                                <button class="export-option" data-format="png">
                                    <span class="btn-icon">üñºÔ∏è</span>
                                    Exportar como PNG
                                </button>
                                <button class="export-option" data-format="pdf">
                                    <span class="btn-icon">üìÑ</span>
                                    Exportar como PDF
                                </button>
                                <div class="export-section">
                                    <button class="export-option" data-format="json">
                                        <span class="btn-icon">üìã</span>
                                        Exportar dados (JSON)
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Avatar do usu√°rio -->
                        <div class="user-avatar-container">
                            <div id="user-avatar" class="user-avatar">
                                <img id="user-avatar-img" src="" alt="Avatar" style="display: none;">
                                <span id="user-avatar-initials" class="user-avatar-initials"></span>
                            </div>
                            
                            <!-- Menu dropdown do usu√°rio -->
                            <div class="user-menu" id="user-menu">
                                <div class="user-menu-header">
                                    <div class="user-menu-avatar">
                                        <img id="user-menu-avatar-img" src="" alt="Avatar" style="display: none;">
                                        <span id="user-menu-avatar-initials" class="user-menu-avatar-initials"></span>
                                    </div>
                                    <div class="user-menu-info">
                                        <div id="user-menu-name" class="user-menu-name"></div>
                                        <div id="user-menu-email" class="user-menu-email"></div>
                                    </div>
                                </div>
                                <div class="user-menu-actions">
                                    <button id="logout-btn" class="user-menu-btn">
                                        <span class="btn-icon">üö™</span>
                                        Sair
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Process Info Card -->
        <div class="process-info-card">
            <div class="process-info-content">
                <div class="process-info-left">
                    <div class="process-name-section">
                        <h3>Nome do Processo</h3>
                        <div class="process-name" id="process-name">Novo Processo</div>
                    </div>
                    
                    <div class="actors-section">
                        <h3>Atores</h3>
                        <div class="actors-legend" id="actors-legend">
                            <!-- Atores ser√£o inseridos aqui dinamicamente -->
                        </div>
                    </div>
                </div>
                
                <div class="zoom-info" id="zoom-info">
                    Zoom: 100%
                </div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Controles de Hist√≥rico -->
                <div class="history-controls">
                    <button id="undo-btn" class="modern-btn secondary small" disabled>
                        <span class="btn-icon">‚Ü∂</span>
                        <span class="btn-text">Desfazer</span>
                    </button>
                    <button id="redo-btn" class="modern-btn secondary small" disabled>
                        <span class="btn-icon">‚Ü∑</span>
                        <span class="btn-text">Refazer</span>
                    </button>
                </div>

                <!-- Nome do Processo -->
                <div class="form-group">
                    <label for="process-name-input">Nome do Processo</label>
                    <input type="text" id="process-name-input" value="Novo Processo" placeholder="Digite o nome do processo">
                </div>

                <!-- Gerenciamento de Atores -->
                <div class="form-group">
                    <label for="actor-name">Adicionar Ator</label>
                    <input type="text" id="actor-name" placeholder="Nome do ator">
                    
                    <label for="actor-color" style="margin-top: 8px;">Cor do Ator</label>
                    <div class="color-picker" id="color-picker">
                        <div class="color-option" data-color="#3b82f6" style="background: #3b82f6;"></div>
                        <div class="color-option" data-color="#ef4444" style="background: #ef4444;"></div>
                        <div class="color-option" data-color="#10b981" style="background: #10b981;"></div>
                        <div class="color-option" data-color="#f59e0b" style="background: #f59e0b;"></div>
                        <div class="color-option" data-color="#8b5cf6" style="background: #8b5cf6;"></div>
                        <div class="color-option" data-color="#ec4899" style="background: #ec4899;"></div>
                        <div class="color-option" data-color="#6b7280" style="background: #6b7280;"></div>
                        <div class="color-option selected" data-color="#1f2937" style="background: #1f2937;"></div>
                    </div>
                    
                    <button id="add-actor-btn" class="modern-btn primary" style="margin-top: 8px;">
                        <span class="btn-icon">üë§</span>
                        <span class="btn-text">Adicionar Ator</span>
                    </button>
                    
                    <div class="actors-list" id="actors-list">
                        <!-- Atores ser√£o inseridos aqui dinamicamente -->
                    </div>
                </div>

                <!-- Adicionar Elementos -->
                <div class="form-group">
                    <label>Adicionar Elementos</label>
                    <button id="add-start-btn" class="modern-btn success">
                        <span class="btn-icon">‚ñ∂Ô∏è</span>
                        <span class="btn-text">In√≠cio</span>
                    </button>
                    <button id="add-task-btn" class="modern-btn primary">
                        <span class="btn-icon">üìã</span>
                        <span class="btn-text">Tarefa</span>
                    </button>
                    <button id="add-gateway-btn" class="modern-btn warning">
                        <span class="btn-icon">‚óÜ</span>
                        <span class="btn-text">Gateway</span>
                    </button>
                    <button id="add-end-btn" class="modern-btn danger">
                        <span class="btn-icon">‚èπÔ∏è</span>
                        <span class="btn-text">Fim</span>
                    </button>
                </div>

                <!-- Configura√ß√µes do Elemento Selecionado -->
                <div id="element-config" style="display: none;">
                    <div class="form-group">
                        <label for="element-text">Texto do Elemento</label>
                        <textarea id="element-text" placeholder="Digite o texto do elemento"></textarea>
                    </div>
                    
                    <div class="form-group" id="actor-select-group" style="display: none;">
                        <label for="element-actor">Ator Respons√°vel</label>
                        <select id="element-actor">
                            <option value="">Selecione um ator</option>
                        </select>
                    </div>

                    <!-- Painel de Gateway -->
                    <div id="gateway-panel" class="gateway-panel" style="display: none;">
                        <h3>Configurar Caminhos do Gateway</h3>
                        <div class="gateway-paths" id="gateway-paths">
                            <!-- Caminhos ser√£o inseridos aqui dinamicamente -->
                        </div>
                        <div class="gateway-buttons">
                            <button id="add-path-btn" class="modern-btn primary small">
                                <span class="btn-icon">‚ûï</span>
                                <span class="btn-text">Adicionar Caminho</span>
                            </button>
                        </div>
                    </div>

                    <button id="delete-element-btn" class="modern-btn danger">
                        <span class="btn-icon">üóëÔ∏è</span>
                        <span class="btn-text">Excluir Elemento</span>
                    </button>
                </div>

                <!-- Instru√ß√µes -->
                <div class="instructions">
                    <h4>Como usar:</h4>
                    <ul>
                        <li>Adicione atores e elementos</li>
                        <li>Clique nos elementos para configurar</li>
                        <li>Arraste para conectar elementos</li>
                        <li>Use Ctrl+Z para desfazer</li>
                        <li>Salve seu trabalho regularmente</li>
                    </ul>
                </div>
            </div>

            <!-- Canvas Area -->
            <div class="canvas-container">
                <div class="canvas-controls">
                    <button id="zoom-in-btn">üîç+</button>
                    <button id="zoom-out-btn">üîç-</button>
                    <button id="zoom-reset-btn">100%</button>
                    <button id="center-view-btn">üéØ</button>
                </div>
                
                <div id="drawflow">
                    <div class="drawflow"></div>
                </div>
                
                <!-- Container para labels de conex√£o -->
                <div class="connection-label-container" id="connection-label-container"></div>
            </div>
        </div>
    </div>

    <!-- Popup de Descri√ß√£o -->
    <div id="description-popup" class="description-popup">
        <div class="description-popup-content">
            <div class="description-popup-header">
                <h3 class="description-popup-title">Descri√ß√£o da Tarefa</h3>
                <button class="description-popup-close" id="description-popup-close">√ó</button>
            </div>
            <div class="description-popup-body">
                <label for="task-description-textarea">Descri√ß√£o detalhada:</label>
                <textarea id="task-description-textarea" placeholder="Digite uma descri√ß√£o detalhada para esta tarefa..."></textarea>
            </div>
            <div class="description-popup-footer">
                <button id="description-cancel-btn" class="modern-btn secondary">Cancelar</button>
                <button id="description-save-btn" class="modern-btn primary">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Popup de Carregamento -->
    <div id="load-popup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="popup-header">
                <h3>Carregar Processo</h3>
                <button class="popup-close" id="load-popup-close">√ó</button>
            </div>
            <div class="popup-body">
                <div class="search-container">
                    <input type="text" id="flow-search" class="search-input" placeholder="Buscar processos...">
                </div>
                <div class="flows-container" id="flows-container">
                    <!-- Fluxos ser√£o carregados aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Processando...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/js/firebase-config.js"></script>
    <script src="src/js/auth.js"></script>
    <script src="src/js/script.js"></script>
</body>
</html>
